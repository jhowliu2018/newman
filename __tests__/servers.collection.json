{
	"info": {
		"_postman_id": "1a78f547-981b-4fc8-9111-4454cb5a4b30",
		"name": "Server CRUD",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"_postman_id": "b87496fa-90f6-4248-a11b-c1076e8816da",
			"name": "Login with potato id",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e1b3ef32-6943-494f-bdc7-2cc4fd4f3363",
						"type": "text/javascript",
						"exec": [
							"eval(globals.postmanBDD);",
							"",
							"describe('Login with potato id', () => {",
							"  it('should return a valid response', () => {",
							"    expect(response.status).to.equal(200)",
							"  });",
							"",
							"  it('should return not null body', () => {",
							"    expect(response.body.length).to.be.above(0) ",
							"  })",
							"",
							"  pm.globals.set('AUTH_TOKEN', response.body);",
							"  pm.globals.set('SERVER_IDS', JSON.stringify([]));",
							"})",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "17357a6e-9466-4ccb-aad0-9c8c9a7cfb1d",
						"type": "text/javascript",
						"exec": [
							"",
							"pm.globals.unset(\"auth_token\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"potatoId\": \"xw61lq\"\n}"
				},
				"url": {
					"raw": "https://dev-portal.pentium.network/api/account/potato/token",
					"protocol": "https",
					"host": [
						"dev-portal",
						"pentium",
						"network"
					],
					"path": [
						"api",
						"account",
						"potato",
						"token"
					]
				},
				"description": "get auth token with potato id"
			},
			"response": []
		},
		{
			"_postman_id": "523706d0-ec6f-48e3-a2a0-6679d2bda8e7",
			"name": "Create Server",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "564e8a6b-2821-4c86-8342-552a59dbff9e",
						"type": "text/javascript",
						"exec": [
							"eval(globals.postmanBDD);",
							"",
							"describe(\"Create server\", () => {",
							"  it(\"Should return a valid response.\", () => {",
							"    expect(response.status).to.equal(200);",
							"  });",
							"  ",
							"  it(\"Should return a valid body.\", () => {",
							"    // https://www.liquid-technologies.com/online-json-to-schema-converter",
							"    const schema = {",
							"      \"$schema\": \"http://json-schema.org/draft-04/schema#\",",
							"      \"type\": \"object\",",
							"      \"properties\": {",
							"        \"id\": {",
							"          \"type\": \"string\",",
							"          \"examples\": [",
							"            \"xOaVQo\"",
							"          ]",
							"        }",
							"      },",
							"      \"required\": [",
							"        \"id\"",
							"      ] ",
							"    }",
							"    expect(tv4.validate(response.body, schema)).to.be.true;",
							"    ",
							"    const servers = JSON.parse(pm.globals.get(\"SERVER_IDS\"));",
							"    servers.push(response.body.id)",
							"    pm.globals.set('SERVER_IDS', JSON.stringify(servers));",
							"  });",
							"",
							"  ",
							"});"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{AUTH_TOKEN}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n   \"name\": \"跳板的伺服器24\",\n   \"description\": \"\",\n   \"createAt\": 1534176000,\n   \"features\": \"跳板的伺服器2\",\n   \"ip\": \"191.121.1.142\",\n   \"port\": \"35\",\n   \"domainName\": \"\",\n   \"keyId\": null,\n   \"account\": \"1111\",\n   \"region\": \"TW\",\n   \"machineParams\": \"\",\n   \"envType\": \"local\",\n   \"teams\": [\n      \"x4BrO7\"\n   ],\n   \"otherIps\": [\n      {\n         \"ip\": \"190.55.31.31\",\n         \"description\": \"\"\n      },\n      {\n         \"ip\": \"190.55.31.41\",\n         \"description\": \"\"\n      }\n   ],\n   \"os\": \"CentOS 7.x\",\n   \"sshPassword\": \"test\"\n}"
				},
				"url": {
					"raw": "https://rke-portal.pentium.network/api/server/",
					"protocol": "https",
					"host": [
						"rke-portal",
						"pentium",
						"network"
					],
					"path": [
						"api",
						"server",
						""
					]
				}
			},
			"response": []
		},
		{
			"_postman_id": "9a231f52-a526-45be-9d87-3466832936b3",
			"name": "Delete Servers",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "0f9356ce-c500-4165-b764-abd4fd502493",
						"type": "text/javascript",
						"exec": [
							"eval(globals.postmanBDD);",
							"",
							"describe(\"Delete servers\", () => {",
							"  it(\"Should return a valid response\", () => {",
							"    expect(response.status).to.equal(200);",
							"  });",
							"  ",
							"  it(\"Should return a valid body\", () => {",
							"    const schema = {",
							"      \"$schema\": \"http://json-schema.org/draft-04/schema#\",",
							"      \"type\": \"object\",",
							"      \"properties\": {",
							"        \"id\": {",
							"          \"type\": \"array\",",
							"          \"examples\": [",
							"            \"xOaVQo\",",
							"            \"xOaVQ2\"",
							"          ]",
							"        }",
							"      },",
							"      \"required\": [",
							"        \"id\"",
							"      ] ",
							"    }  ",
							"    expect(tv4.validate(response.body, schema)).to.be.true;",
							"  });",
							"  ",
							"  it(\"Should delete correct servers\", () => {",
							"    const servers = JSON.parse(pm.globals.get(\"SERVER_IDS\"));",
							"    expect(response.body.id).to.be.an(\"array\")",
							"    expect(response.body.id.length).to.equal(servers.length)",
							"    expect(response.body.id).to.include.members(servers)",
							"  })",
							"});"
						]
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Authorization",
						"value": "{{AUTH_TOKEN}}"
					},
					{
						"key": "asdsa",
						"value": "{{SERVER_IDS}}"
					},
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"serverIds\": {{SERVER_IDS}}\n}"
				},
				"url": {
					"raw": "https://rke-portal.pentium.network/api/servers/",
					"protocol": "https",
					"host": [
						"rke-portal",
						"pentium",
						"network"
					],
					"path": [
						"api",
						"servers",
						""
					]
				}
			},
			"response": []
		}
	]
}